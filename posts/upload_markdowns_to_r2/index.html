<!doctype html><html lang=zh-TW><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.121.2"><title>打包 markdown 筆記並上傳到 R2 (S3 like service) | Ryan's blog </title><link rel=stylesheet href=https://blog.cwc.tw/css/simpleness.css><link rel=canonical href=https://blog.cwc.tw/posts/upload_markdowns_to_r2/><link rel=alternate type=application/rss+xml href title="Ryan's blog"><link href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/css/all.min.css rel=stylesheet></head><body class=container><nav class=navigation><div class=nav-left><div class="nav-item nav-title"><a href=https://blog.cwc.tw/>Ryan's blog</a></div><div class="nav-item nav-menu"><a href=/categories/coding>Coding</a>
<a href=/categories/hiking>Hiking</a></div></div><div class="nav-item nav-right fontawesome"><a href=https://twitter.com/v_kiiii target=_blank><i title=Twitter class="fab fa-twitter"></i>
</a><a href=https://github.com/ryanchentw target=_blank><i title=GitHub class="fab fa-github"></i></a></div></nav><article class=post><header class=post-header><h1 style=text-align:center>打包 markdown 筆記並上傳到 R2 (S3 like service)</h1><div class=post-metadata><time datetime=2022-08-20T15:22:09+08:00>August 20, 2022</time> &nbsp;</div></header><div class=post-text><p>自從用 markdown 開始寫工作日誌與筆記，一直放在 iCloud 上面，之前看到 iCloud 掉資料的新聞覺得好像還是有必要多異地備份一下，那時候選了 S3，看重的當然是 11 nines 的耐用性，這樣畢生筆記萬無一失了吧。</p><p>這陣子發現 Cloudflare 的 R2 可以開始用 <a href=https://blog.cloudflare.com/r2-open-beta/>beta</a> 版本了，基於我本人是 Cloudflare 無腦粉，馬上就想把目前的筆記也丟一份放在上面，於是就來研究一下。</p><p>首先 Cloudflare R2 跟 S3 一樣是 11 nines，對外宣稱的耐用性跟 S3 一樣，再來是每 GB 價錢，R2 目前是 $0.015 per GB per month，跟 S3 Virginia $0.023 比起來低了 35%，再來是資料不收輸出的頻寬費用，這點我自己很好奇，那不就可以拿來做一個免費的圖床？最後是跟 s3 相容的 api 把 api token 申請好之後就可以直接用 aws cli 上傳檔案。</p><p>一開始到 <a href=https://dash.cloudflare.com/sign-up/r2>https://dash.cloudflare.com/sign-up/r2</a> 申請服務，可以看到開 bucket 是不用選 region 的，下面說明 <code>R2 buckets are automatically distributed across Cloudflare's data centers</code> 另外也注意到 bucket name 應該是帳號內不能相同，跟 AWS 整個 region 不能有相同的 bucket name 不一樣。</p><p><img src=https://i.imgur.com/olqi0fC.png alt="create bucket"></p><p>開完 bucket 之後開始處理懶人指令的部分</p><ol><li>註冊 API token</li><li>aws configure 設定</li><li>複製 Account ID</li><li>假設你的筆記資料夾在 <code>notes/</code>, 上傳到 {bucket_name}, 使用 {account_id} 的 R2 endpoint</li></ol><p>最後懶人指令會長這樣</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>export FILENAME<span style=color:#f92672>=</span>notes_<span style=color:#66d9ef>$(</span>date +<span style=color:#e6db74>&#34;%Y-%m-%d&#34;</span><span style=color:#66d9ef>)</span>.tar.xz; <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>tar -chJf $FILENAME notes/ <span style=color:#f92672>&amp;&amp;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>aws s3api put-object --bucket <span style=color:#f92672>{</span>bucket_name<span style=color:#f92672>}</span> --key $FILENAME --body $FILENAME --endpoint-url https://<span style=color:#f92672>{</span>account_id<span style=color:#f92672>}</span>.r2.cloudflarestorage.com
</span></span></code></pre></div><p><img src=https://i.imgur.com/6a9gpIs.png alt="api token">
<img src=https://i.imgur.com/3AhN3IY.png alt="aws configure"></p><p>refs.</p><ul><li><a href=https://developers.cloudflare.com/r2/examples/aws-cli/>https://developers.cloudflare.com/r2/examples/aws-cli/</a></li></ul></div><footer class=post-footer></footer><div class=comments><div class=comments></div></div></article><div class=foot>&copy; - 2024 &#183;
<a href=/>Ryan's blog </a>&#183;
Theme <a href=https://github.com/RainerChiang/simpleness>Simpleness</a> Powered by <a href=https://gohugo.io/>Hugo</a> &#183;
<a href=#><i class="fas fa-chevron-up"></i></a></div></body></html>